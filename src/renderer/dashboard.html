<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>VerseCon Link - Dashboard</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Rajdhani:wght@400;600;700&display=swap');

        :root {
            --bg-deep: #0b0c10;
            --bg-panel: rgba(31, 40, 51, 0.6);
            --accent: #ffa500;
            --accent-glow: rgba(255, 165, 0, 0.4);
            --text-main: #e0e0e0;
            --text-dim: #8892b0;
            --border: rgba(255, 255, 255, 0.1);
            --danger: #ff4444;
            --success: #00ff88;
            --cyan: #00c8ff;
        }

        body {
            background: radial-gradient(circle at top right, #1f2833 0%, var(--bg-deep) 60%);
            color: var(--text-main);
            font-family: 'Rajdhani', sans-serif;
            margin: 0;
            display: flex;
            height: 100vh;
            overflow: hidden;
            user-select: none;
        }

        .title-bar-drag {
            -webkit-app-region: drag;
        }

        .no-drag {
            -webkit-app-region: no-drag;
        }

        /* ‚ïê‚ïê‚ïê SIDEBAR ‚ïê‚ïê‚ïê */
        .sidebar {
            width: 260px;
            background: rgba(11, 12, 16, 0.9);
            backdrop-filter: blur(12px);
            border-right: 1px solid var(--border);
            padding: 20px;
            display: flex;
            flex-direction: column;
            box-shadow: 5px 0 15px rgba(0, 0, 0, 0.3);
            z-index: 10;
        }

        .brand {
            font-size: 1.6rem;
            font-weight: 700;
            color: white;
            margin-bottom: 30px;
            text-transform: uppercase;
            letter-spacing: 2px;
            text-shadow: 0 0 10px var(--accent-glow);
            border-left: 4px solid var(--accent);
            padding-left: 12px;
        }

        .menu-item {
            padding: 10px 12px;
            margin-bottom: 6px;
            border-radius: 6px;
            cursor: pointer;
            color: var(--text-dim);
            font-size: 1rem;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
            position: relative;
        }

        .menu-item:hover {
            background: rgba(255, 255, 255, 0.05);
            color: white;
            transform: translateX(3px);
        }

        .menu-item.active {
            background: linear-gradient(90deg, rgba(255, 165, 0, 0.2) 0%, transparent 100%);
            border-left: 3px solid var(--accent);
            color: var(--accent);
        }

        .badge {
            position: absolute;
            right: 8px;
            top: 50%;
            transform: translateY(-50%);
            background: var(--danger);
            color: white;
            font-size: 0.7rem;
            padding: 2px 6px;
            border-radius: 10px;
            font-weight: 700;
            min-width: 18px;
            text-align: center;
        }

        /* ‚ïê‚ïê‚ïê STATUS BOX ‚ïê‚ïê‚ïê */
        .status-box {
            margin-top: auto;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 12px;
        }

        .status-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 6px;
            font-size: 0.85rem;
        }

        .status-label {
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--text-dim);
        }

        .dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            box-shadow: 0 0 5px currentColor;
        }

        .dot.on {
            background: var(--success);
            color: var(--success);
        }

        .dot.off {
            background: var(--danger);
            color: var(--danger);
        }

        /* ‚ïê‚ïê‚ïê MAIN AREA ‚ïê‚ïê‚ïê */
        .main {
            flex: 1;
            padding: 25px;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
            margin-bottom: 20px;
            padding-bottom: 12px;
            border-bottom: 1px solid var(--border);
        }

        h2 {
            font-size: 1.4rem;
            margin: 0;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--accent);
        }

        .subtitle {
            font-size: 0.85rem;
            color: var(--text-dim);
        }

        /* ‚ïê‚ïê‚ïê FEED ‚ïê‚ïê‚ïê */
        .feed-container {
            flex: 1;
            overflow-y: auto;
            background: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(5px);
            border-radius: 10px;
            border: 1px solid var(--border);
            padding: 15px;
        }

        .feed-item {
            display: grid;
            grid-template-columns: 70px 36px 1fr;
            align-items: center;
            padding: 10px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            animation: slideIn 0.4s ease forwards;
            opacity: 0;
            transform: translateX(-10px);
        }

        .feed-time {
            font-family: monospace;
            color: var(--text-dim);
            font-size: 0.8rem;
        }

        .feed-icon {
            font-size: 1.1rem;
            text-align: center;
            background: rgba(255, 255, 255, 0.05);
            width: 28px;
            height: 28px;
            line-height: 28px;
            border-radius: 5px;
        }

        .feed-text {
            font-size: 0.95rem;
            color: #ddd;
        }

        .feed-highlight {
            color: var(--accent);
            font-weight: 600;
            text-shadow: 0 0 10px rgba(255, 165, 0, 0.3);
        }

        /* ‚ïê‚ïê‚ïê CONTROLS ‚ïê‚ïê‚ïê */
        input.modern-input {
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid var(--border);
            color: white;
            padding: 10px;
            border-radius: 6px;
            width: 100%;
            font-family: inherit;
        }

        input.modern-input:focus {
            outline: none;
            border-color: var(--accent);
        }

        button.cyber-btn {
            background: linear-gradient(45deg, #ffa500, #ff8800);
            color: #000;
            border: none;
            padding: 10px 16px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            clip-path: polygon(8px 0, 100% 0, 100% calc(100% - 8px), calc(100% - 8px) 100%, 0 100%, 0 8px);
            cursor: pointer;
            transition: all 0.2s;
            -webkit-app-region: no-drag;
            font-family: inherit;
        }

        button.cyber-btn:hover {
            filter: brightness(1.2);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(255, 165, 0, 0.4);
        }

        button.cyber-btn.small {
            padding: 6px 10px;
            font-size: 0.75rem;
        }

        button.cyber-btn.danger {
            background: linear-gradient(45deg, #ff4444, #cc0000);
            color: white;
        }

        button.cyber-btn.success {
            background: linear-gradient(45deg, #00ff88, #00cc66);
            color: #000;
        }

        /* ‚ïê‚ïê‚ïê COMMAND BUTTONS ‚ïê‚ïê‚ïê */
        .cmd-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 8px;
            margin-bottom: 15px;
        }

        .cmd-btn {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 12px 8px;
            cursor: pointer;
            text-align: center;
            color: var(--text-dim);
            transition: all 0.2s;
            font-family: inherit;
            font-size: 0.8rem;
        }

        .cmd-btn:hover {
            border-color: var(--accent);
            color: white;
            background: rgba(255, 165, 0, 0.1);
            transform: translateY(-2px);
        }

        .cmd-btn .cmd-icon {
            font-size: 1.4rem;
            display: block;
            margin-bottom: 4px;
        }

        /* ‚ïê‚ïê‚ïê UNKNOWN PATTERNS ‚ïê‚ïê‚ïê */
        .unknown-item {
            display: flex;
            flex-direction: column;
            gap: 4px;
            padding: 10px 12px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.03);
            font-size: 0.8rem;
            transition: background 0.2s;
        }

        .unknown-item:hover {
            background: rgba(255, 165, 0, 0.05);
        }

        .unknown-header {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .unknown-key {
            flex: 1;
            color: var(--accent);
            font-family: 'Rajdhani', sans-serif;
            font-weight: 600;
            font-size: 0.8rem;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .unknown-sample {
            font-family: 'Courier New', monospace;
            font-size: 0.65rem;
            color: var(--text-dim);
            background: rgba(0, 0, 0, 0.3);
            padding: 4px 8px;
            border-radius: 4px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            max-width: 100%;
        }

        .unknown-count {
            color: var(--text-dim);
            font-size: 0.7rem;
            min-width: 40px;
            text-align: right;
        }

        .unknown-actions {
            display: flex;
            gap: 4px;
        }

        .unknown-actions button {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: var(--text-dim);
            padding: 2px 8px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.7rem;
        }

        .unknown-actions button:hover {
            border-color: var(--accent);
            color: var(--accent);
        }

        .unknown-actions button.btn-ignore:hover {
            border-color: #ff4444;
            color: #ff4444;
        }

        /* ‚ïê‚ïê‚ïê ALERT COOLDOWN SLIDERS ‚ïê‚ïê‚ïê */
        .cooldown-row {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 6px;
        }

        .cooldown-row label {
            font-size: 0.75rem;
            color: var(--text-dim);
            min-width: 120px;
        }

        .cooldown-row input[type=range] {
            flex: 1;
        }

        .cooldown-row .cooldown-val {
            font-size: 0.7rem;
            color: var(--accent);
            min-width: 30px;
            text-align: right;
        }

        /* ‚ïê‚ïê‚ïê COMMAND LOG ‚ïê‚ïê‚ïê */
        .cmd-log-item {
            padding: 8px 12px;
            border-left: 3px solid var(--accent);
            margin-bottom: 6px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 0 6px 6px 0;
        }

        .cmd-log-from {
            font-size: 0.75rem;
            color: #888;
        }

        .cmd-log-text {
            font-size: 1rem;
            color: var(--accent);
            font-weight: 600;
        }

        .cmd-log-target {
            font-size: 0.75rem;
            color: var(--cyan);
        }

        .cmd-log-ack {
            font-size: 0.75rem;
            color: var(--success);
            margin-top: 2px;
        }

        /* ‚ïê‚ïê‚ïê TARGET SELECTOR ‚ïê‚ïê‚ïê */
        select.target-select {
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid var(--border);
            color: white;
            padding: 8px;
            border-radius: 6px;
            font-family: inherit;
            font-size: 0.9rem;
        }

        select.target-select:focus {
            outline: none;
            border-color: var(--accent);
        }

        /* ‚ïê‚ïê‚ïê SECTION TITLE ‚ïê‚ïê‚ïê */
        .section-title {
            font-size: 0.8rem;
            color: var(--text-dim);
            text-transform: uppercase;
            letter-spacing: 2px;
            margin: 15px 0 8px 0;
            padding-bottom: 5px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        /* ‚ïê‚ïê‚ïê SCROLLBAR ‚ïê‚ïê‚ïê */
        ::-webkit-scrollbar {
            width: 6px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.2);
        }

        ::-webkit-scrollbar-thumb {
            background: #333;
            border-radius: 3px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--accent);
        }

        @keyframes slideIn {
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        /* Hide views by default */
        .view {
            display: none;
            flex-direction: column;
            flex: 1;
            padding: 25px;
            overflow: hidden;
        }

        .view.active {
            display: flex;
        }
    </style>
</head>

<body>
    <div class="sidebar title-bar-drag">
        <div class="brand">VerseCon <span style="color:white; font-weight:300;">Link</span></div>

        <div class="menu-item active no-drag" id="nav-dashboard" onclick="switchTab('dashboard')">
            <span>üìä</span> Dashboard
        </div>
        <div class="menu-item no-drag" id="nav-vcon" onclick="switchTab('vcon')">
            <span>üåê</span> VerseCon Feed
        </div>
        <div class="menu-item no-drag" id="nav-command" onclick="switchTab('command')">
            <span>üì¢</span> Command
        </div>
        <div class="menu-item no-drag" id="nav-config" onclick="switchTab('config')">
            <span>‚öôÔ∏è</span> Settings
            <span class="badge" id="unknown-badge" style="display:none;">0</span>
        </div>
        <div class="menu-item no-drag" onclick="toggleOverlay()">
            <span>üì∫</span> Toggle Overlay
        </div>

        <div style="flex:1"></div>

        <div style="margin-bottom: 15px;" class="no-drag">
            <div style="font-size: 0.75rem; color: var(--text-dim); margin-bottom: 5px;">VERSECON AUTH</div>
            <div id="auth-ui-guest">
                <button class="cyber-btn no-drag" style="width:100%; margin:0;" onclick="openLogin()">Login with
                    VerseCon</button>
                <div style="font-size: 0.65rem; color: #555; margin-top: 4px; text-align: center;">Opens browser to
                    authenticate</div>
            </div>
            <div id="auth-ui-user"
                style="display:none; background: rgba(0,255,136,0.1); padding: 8px; border-radius: 6px; border: 1px solid #00ff88;">
                <div style="color: #00ff88; font-weight: bold; font-size: 0.85rem;">‚úì Authenticated</div>
                <div style="font-size: 0.65rem; color: #aaa;" id="auth-token-display">Session Active</div>
            </div>
        </div>

        <div class="status-box">
            <div class="status-row">
                <div class="status-label"><span class="dot off" id="status-log-dot"></span> Game Log</div>
                <span id="status-log-text" style="font-size:0.75rem;">Searching...</span>
            </div>
            <div class="status-row">
                <div class="status-label"><span class="dot off" id="status-api-dot"></span> API Link</div>
                <span id="status-api-text" style="font-size:0.75rem;">Disconnected</span>
            </div>
        </div>
    </div>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê DASHBOARD VIEW ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <div class="view active" id="view-dashboard">
        <div class="header">
            <div>
                <h2>Operations Live Feed</h2>
                <div class="subtitle">Real-time telemetry from Star Citizen</div>
            </div>
            <div style="font-family: monospace; color: var(--accent);">V.2.2.0</div>
        </div>
        <div class="feed-container" id="event-feed">
            <div class="feed-item">
                <span class="feed-time">SYSTEM</span>
                <span class="feed-icon">‚úîÔ∏è</span>
                <span class="feed-text">System initialized. Waiting for Game.log stream...</span>
            </div>
        </div>
    </div>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê VERSECON FEED VIEW ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <div class="view" id="view-vcon">
        <div class="header">
            <div>
                <h2>VerseCon Feed</h2>
                <div class="subtitle">Live contracts, beacons, operations & LFG from the platform</div>
            </div>
        </div>
        <div class="feed-container" id="vcon-feed">
            <div class="feed-item">
                <span class="feed-time">SYSTEM</span>
                <span class="feed-icon">üåê</span>
                <span class="feed-text">Connect to VerseCon to receive live platform updates...</span>
            </div>
        </div>
    </div>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê COMMAND CENTER VIEW ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <div class="view" id="view-command">
        <div class="header">
            <div>
                <h2>Command Center</h2>
                <div class="subtitle">Issue orders to teams and individuals</div>
            </div>
        </div>

        <div style="overflow-y: auto; flex:1;">
            <div class="section-title">Quick Orders</div>
            <div class="cmd-grid">
                <div class="cmd-btn" onclick="sendPresetCommand('RTB')"><span class="cmd-icon">üè†</span>RTB</div>
                <div class="cmd-btn" onclick="sendPresetCommand('DEFEND')"><span class="cmd-icon">üõ°Ô∏è</span>Defend</div>
                <div class="cmd-btn" onclick="sendPresetCommand('ENGAGE')"><span class="cmd-icon">üéØ</span>Engage</div>
                <div class="cmd-btn" onclick="sendPresetCommand('FALL BACK')"><span class="cmd-icon">‚¨ÖÔ∏è</span>Fall Back
                </div>
                <div class="cmd-btn" onclick="sendPresetCommand('REGROUP')"><span class="cmd-icon">üîÑ</span>Regroup
                </div>
                <div class="cmd-btn" onclick="sendPresetCommand('HOLD FIRE')"><span class="cmd-icon">‚úã</span>Hold Fire
                </div>
                <div class="cmd-btn" onclick="sendPresetCommand('ESCORT')"><span class="cmd-icon">üöÄ</span>Escort</div>
                <div class="cmd-btn" onclick="sendPresetCommand('COVER ME')"><span class="cmd-icon">üî•</span>Cover Me
                </div>
                <div class="cmd-btn" onclick="sendPresetCommand('ALL CLEAR')"><span class="cmd-icon">‚úÖ</span>All Clear
                </div>
                <div class="cmd-btn" onclick="sendPresetCommand('EMERGENCY')" style="border-color: var(--danger);"><span
                        class="cmd-icon">üÜò</span>SOS</div>
            </div>

            <div class="section-title">Custom Command</div>
            <div style="display: flex; gap: 8px; margin-bottom: 5px;">
                <select class="target-select" id="cmd-target" style="min-width: 120px;">
                    <option value="ALL">üåê All Teams</option>
                    <option value="ALPHA">üè∑Ô∏è Alpha</option>
                    <option value="BRAVO">üè∑Ô∏è Bravo</option>
                    <option value="CHARLIE">üè∑Ô∏è Charlie</option>
                    <option value="DELTA">üè∑Ô∏è Delta</option>
                </select>
                <input class="modern-input" id="cmd-custom-text" placeholder="Type custom order..."
                    style="flex:1; margin:0;">
                <button class="cyber-btn" onclick="sendCustomCommand()" style="width:auto; margin:0;">Send</button>
            </div>
            <div style="margin-bottom: 15px; display: flex; align-items: center; gap: 10px;">
                <label style="cursor: pointer; color: var(--text-dim); font-size: 0.8rem;">
                    <input type="checkbox" id="cmd-broadcast"> Broadcast to Overlay (Whole Screen)
                </label>
            </div>

            <div class="section-title">Command Log</div>
            <div class="feed-container" id="command-log" style="flex:1; min-height: 200px;">
                <div style="color: #555; font-style: italic; padding: 10px;">No commands issued yet...</div>
            </div>
        </div>
    </div>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê CONFIGURATION VIEW ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <div class="view" id="view-config">
        <div class="header">
            <div>
                <h2>Configuration</h2>
                <div class="subtitle">Settings, Log Path & Unknown Events</div>
            </div>
        </div>

        <div style="overflow-y: auto; flex:1;">
            <!-- Game Log Path -->
            <div
                style="background: rgba(0,0,0,0.3); padding: 15px; border-radius: 8px; border: 1px solid var(--border); margin-bottom: 15px;">
                <div class="section-title" style="margin-top: 0;">Game Log Path</div>
                <div style="display: flex; gap: 8px;">
                    <input type="text" id="config-log-path" class="modern-input" style="margin:0;" readonly
                        placeholder="No file selected">
                    <button class="cyber-btn" style="width: auto; margin:0;" onclick="selectLogFile()">Browse</button>
                </div>
                <div style="margin-top: 10px; text-align: right;">
                    <button class="cyber-btn small" onclick="window.location.reload()">üîÑ Reload App</button>
                </div>
            </div>

            <!-- Manual Token -->
            <div
                style="background: rgba(0,0,0,0.3); padding: 15px; border-radius: 8px; border: 1px solid var(--border); margin-bottom: 15px;">
                <div class="section-title" style="margin-top: 0;">Manual Token (Legacy)</div>
                <div style="display: flex; gap: 8px;">
                    <input type="password" id="api-token-manual" class="modern-input"
                        placeholder="Paste token here if login fails" style="margin:0; flex:1;">
                    <button class="cyber-btn" style="width:auto; margin:0;" onclick="loginManual()">Set</button>
                </div>
            </div>

            <!-- Sound Settings -->
            <div
                style="background: rgba(0,0,0,0.3); padding: 15px; border-radius: 8px; border: 1px solid var(--border); margin-bottom: 15px;">
                <div class="section-title" style="margin-top: 0;">Sound & Alerts</div>
                <div class="status-row">
                    <span style="color: var(--text-dim);">Alert Sounds</span>
                    <label style="cursor: pointer;"><input type="checkbox" id="sound-enabled" checked
                            onchange="toggleSounds()"> Enabled</label>
                </div>
                <div class="status-row">
                    <span style="color: var(--text-dim);">Volume</span>
                    <input type="range" id="sound-volume" min="0" max="100" value="70" style="width: 120px;"
                        oninput="updateVolume()">
                </div>
                <div class="status-row">
                    <span style="color: var(--text-dim);">HUD Warnings</span>
                    <label style="cursor: pointer;"><input type="checkbox" id="hud-warnings-enabled" checked>
                        Enabled</label>
                </div>
            </div>

            <!-- Alert Cooldowns -->
            <div
                style="background: rgba(0,0,0,0.3); padding: 15px; border-radius: 8px; border: 1px solid var(--border); margin-bottom: 15px;">
                <div class="section-title" style="margin-top: 0;">Alert Cooldowns</div>
                <div style="font-size: 0.7rem; color: #666; margin-bottom: 10px;">Ignore repeated alerts within the
                    cooldown period (e.g., brief zone changes).</div>
                <div class="cooldown-row">
                    <label>Suffocating</label>
                    <input type="range" id="cd-suffocating" min="0" max="30" value="5"
                        oninput="updateCooldown('suffocating', this.value)">
                    <span class="cooldown-val" id="cd-suffocating-val">5s</span>
                </div>
                <div class="cooldown-row">
                    <label>Depressurizing</label>
                    <input type="range" id="cd-depressurizing" min="0" max="30" value="5"
                        oninput="updateCooldown('depressurizing', this.value)">
                    <span class="cooldown-val" id="cd-depressurizing-val">5s</span>
                </div>
            </div>

            <!-- Ship Image Manager (v2.2) -->
            <div
                style="background: rgba(0,0,0,0.3); padding: 15px; border-radius: 8px; border: 1px solid var(--border); margin-bottom: 15px;">
                <div class="section-title" style="margin-top: 0;">Ship Image Manager</div>
                <div style="font-size: 0.7rem; color: #666; margin-bottom: 10px;">
                    Map ship names found in logs (e.g., "Clipper") to specific images.
                    <br>Partial matches work (e.g., "Clipper" matches "DRAK_Clipper").
                </div>

                <div id="ship-map-list"
                    style="margin-bottom: 10px; max-height: 150px; overflow-y: auto; background: rgba(0,0,0,0.2); border-radius: 4px;">
                    <!-- Items: <div class="map-item">[Name] [Path] [X]</div> -->
                    <div style="padding: 10px; font-style: italic; color: #555; text-align: center;">No mappings set.
                    </div>
                </div>

                <div style="display: flex; gap: 8px;">
                    <input type="text" id="new-ship-name" class="modern-input" placeholder="Ship Name (e.g. Clipper)"
                        style="margin:0; flex:1;">
                    <button class="cyber-btn" style="width: auto; margin:0;" onclick="selectNewShipImage()">Select
                        Image</button>
                    <button class="cyber-btn" style="width: auto; margin:0;" onclick="addShipMapping()">Add
                        Mapping</button>
                </div>
                <input type="hidden" id="new-ship-image-path">
                <div id="new-ship-preview-label"
                    style="font-size: 0.75rem; color: var(--accent); margin-top: 5px; display: none;">Selected: <span
                        id="new-ship-filename"></span></div>
            </div>



            <!-- Built-in Pattern Manager (v2.2) -->
            <div
                style="background: rgba(0,0,0,0.3); padding: 15px; border-radius: 8px; border: 1px solid var(--border); margin-bottom: 15px;">
                <div class="section-title" style="margin-top: 0;">Built-in Pattern Manager</div>
                <div style="font-size: 0.7rem; color: #666; margin-bottom: 10px;">
                    Modify or disable system log patterns. <b>‚ö†Ô∏è Expert Use Only</b> - Breaking these may stop game
                    state
                    updates.
                </div>
                <div id="builtin-pattern-list"
                    style="margin-bottom: 10px; max-height: 200px; overflow-y: auto; background: rgba(0,0,0,0.2); border-radius: 4px;">
                    <div style="padding: 10px; text-align: center; color: #555;">Loading patterns...</div>
                </div>
                <div style="text-align: right; display: flex; justify-content: flex-end; gap: 10px;">
                    <button class="cyber-btn danger" style="width: auto;" onclick="resetPatternOverrides()">Reset
                        All</button>
                    <button class="cyber-btn" style="width: auto;" onclick="loadBuiltinPatterns()">Reload</button>
                    <button class="cyber-btn" style="width: auto;" onclick="savePatternOverrides()">Save
                        Overrides</button>
                </div>
            </div>

            <!-- Manual Log Patterns (v2.2) -->
            <div
                style="background: rgba(0,0,0,0.3); padding: 15px; border-radius: 8px; border: 1px solid var(--border); margin-bottom: 15px;">
                <div class="section-title" style="margin-top: 0;">Manual Log Patterns</div>
                <div style="font-size: 0.7rem; color: #666; margin-bottom: 10px;">
                    Define custom Regex patterns to trigger alerts. Capture groups can be used as values.
                </div>

                <div id="pattern-list"
                    style="margin-bottom: 10px; max-height: 150px; overflow-y: auto; background: rgba(0,0,0,0.2); border-radius: 4px;">
                    <div style="padding: 10px; font-style: italic; color: #555; text-align: center;">No custom patterns
                        defined.</div>
                </div>

                <div style="display: flex; gap: 8px; margin-bottom: 8px;">
                    <input type="text" id="new-pattern-regex" class="modern-input"
                        placeholder="Regex (e.g. /Time: (\d+)%)" style="flex:2; margin:0;">
                    <select id="new-pattern-level" class="modern-input" style="flex:1; margin:0; padding: 0 5px;">
                        <option value="INFO">Info (Blue)</option>
                        <option value="WARN">Warning (Orange)</option>
                        <option value="CRITICAL">Critical (Red/Flash)</option>
                    </select>
                </div>
                <div style="display: flex; gap: 8px;">
                    <input type="text" id="new-pattern-msg" class="modern-input"
                        placeholder="Alert Message (Use $1 for value)" style="flex:1; margin:0;">
                    <button class="cyber-btn" style="width: auto; margin:0;" onclick="addCustomPattern()">Add
                        Pattern</button>
                </div>
            </div>

            <!-- Unknown Log Discovery -->
            <div
                style="background: rgba(0,0,0,0.3); padding: 15px; border-radius: 8px; border: 1px solid var(--border);">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <div class="section-title" style="margin-top: 0; border-bottom: none;">Unknown Log Events <span
                            id="unknown-count-label" style="color: var(--accent);">(0)</span></div>
                    <div style="display: flex; gap: 6px;">
                        <button class="cyber-btn small" onclick="refreshUnknowns()">Refresh</button>
                        <button class="cyber-btn small danger" onclick="clearUnknowns()">Clear All</button>
                    </div>
                </div>
                <div style="font-size: 0.75rem; color: #666; margin-bottom: 10px;">
                    Unmatched log events appear here. <b>üìã Copy</b> the sample to analyze, or <b>üö´ Ignore</b> to hide.
                </div>
                <div class="feed-container" id="unknown-list" style="max-height: 400px; padding: 0;">
                    <div style="color: #555; font-style: italic; padding: 15px; text-align: center;">No unknown patterns
                        detected yet. Play the game to discover new log events.</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const { ipcRenderer } = require('electron');

        // ‚ïê‚ïê‚ïê STATE ‚ïê‚ïê‚ïê
        let soundEnabled = true;
        let soundVolume = 0.7;
        let unknownCount = 0;
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

        // ‚ïê‚ïê‚ïê TAB SWITCHING ‚ïê‚ïê‚ïê
        function switchTab(tab) {
            document.querySelectorAll('.menu-item').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.view').forEach(el => el.classList.remove('active'));

            document.getElementById(`nav-${tab}`).classList.add('active');
            document.getElementById(`view-${tab}`).classList.add('active');
        }

        // ‚ïê‚ïê‚ïê SOUND SYSTEM ‚ïê‚ïê‚ïê
        function playSound(type = 'notification', duration = 150) {
            if (!soundEnabled) return;
            try {
                const osc = audioCtx.createOscillator();
                const gain = audioCtx.createGain();
                gain.gain.value = soundVolume * 0.3;
                osc.connect(gain);
                gain.connect(audioCtx.destination);

                const sounds = {
                    notification: { freq: 880, type: 'sine', dur: 150 },
                    alert_death: { freq: 200, type: 'sawtooth', dur: 800 },
                    alert_status: { freq: 440, type: 'triangle', dur: 400 },
                    alert_zone: { freq: 660, type: 'sine', dur: 250 },
                    command: { freq: 1000, type: 'square', dur: 100 },
                    beacon: { freq: 500, type: 'sine', dur: 300 },
                    contract: { freq: 700, type: 'sine', dur: 200 },
                    sos: { freq: 300, type: 'sawtooth', dur: 600 },
                };

                const s = sounds[type] || sounds.notification;
                osc.frequency.value = s.freq;
                osc.type = s.type;

                osc.start();
                gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + s.dur / 1000);
                osc.stop(audioCtx.currentTime + s.dur / 1000);
            } catch (e) {
                console.error('Sound error:', e);
            }
        }

        function toggleSounds() { soundEnabled = document.getElementById('sound-enabled').checked; }
        function updateVolume() { soundVolume = document.getElementById('sound-volume').value / 100; }

        // ‚ïê‚ïê‚ïê FEED HELPERS ‚ïê‚ïê‚ïê
        function addFeedItem(feedId, icon, text) {
            const feed = document.getElementById(feedId);
            const time = new Date().toLocaleTimeString([], { hour12: false });
            const item = document.createElement('div');
            item.className = 'feed-item';
            item.innerHTML = `
                <span class="feed-time">${time}</span>
                <span class="feed-icon">${icon}</span>
                <span class="feed-text">${text}</span>
            `;
            feed.prepend(item);
            if (feed.children.length > 150) feed.lastElementChild.remove();
        }

        function addDashItem(icon, text) { addFeedItem('event-feed', icon, text); }
        function addVconItem(icon, text) { addFeedItem('vcon-feed', icon, text); }

        // ‚ïê‚ïê‚ïê AUTH ‚ïê‚ïê‚ïê
        function openLogin() {
            console.log('[Dashboard] openLogin clicked!');
            // v2.2 - Use custom protocol redirect
            ipcRenderer.invoke('app:open-external', 'https://versecon.space/api/auth/discord/login?redirect=versecon-link://auth').then(() => {
                addDashItem('üîë', 'Opening browser... Please login.');
            }).catch(err => {
                addDashItem('‚ùå', 'Failed to open browser: ' + err.message);
            });
        }

        function loginManual() {
            const token = document.getElementById('api-token-manual').value;
            if (token) {
                ipcRenderer.send('app:login', token);
                document.getElementById('auth-ui-guest').style.display = 'none';
                document.getElementById('auth-ui-user').style.display = 'block';
                addDashItem('üîí', 'Manual token set.');
            }
        }

        function toggleOverlay() { ipcRenderer.send('app:toggle-overlay'); }

        function selectLogFile() {
            ipcRenderer.invoke('app:select-log').then(path => {
                if (path) {
                    document.getElementById('config-log-path').value = path;
                    addDashItem('‚öôÔ∏è', `Log path set: ${path}`);
                }
            });
        }

        // ‚ïê‚ïê‚ïê COMMAND MODULE ‚ïê‚ïê‚ïê
        function sendPresetCommand(preset) {
            const target = document.getElementById('cmd-target').value;
            const data = { preset, target, timestamp: Date.now() };
            ipcRenderer.send('command:send', data);
            addCommandLog(preset, target, 'YOU');
            playSound(preset === 'EMERGENCY' ? 'sos' : 'command');
        }

        function sendCustomCommand() {
            const text = document.getElementById('cmd-custom-text').value.trim();
            if (!text) return;
            const target = document.getElementById('cmd-target').value;
            const broadcast = document.getElementById('cmd-broadcast').checked;
            const data = { text, target, broadcast, timestamp: Date.now() };
            ipcRenderer.send('command:send', data);
            addCommandLog(text, target, 'YOU');
            document.getElementById('cmd-custom-text').value = '';
            playSound('command');
        }

        function addCommandLog(text, target, from) {
            const log = document.getElementById('command-log');
            // Remove placeholder
            const placeholder = log.querySelector('div[style]');
            if (placeholder && placeholder.textContent.includes('No commands')) placeholder.remove();

            const time = new Date().toLocaleTimeString([], { hour12: false });
            const item = document.createElement('div');
            item.className = 'cmd-log-item';
            item.innerHTML = `
                <div class="cmd-log-from">${time} ‚Äî FROM: ${from}</div>
                <div class="cmd-log-text">${text}</div>
                <div class="cmd-log-target">‚Üí ${target}</div>
                <div class="cmd-log-ack" id="ack-${Date.now()}">‚è≥ Awaiting ACK...</div>
            `;
            log.prepend(item);
        }

        // ‚ïê‚ïê‚ïê SHIP IMAGE MANAGER (v2.2) ‚ïê‚ïê‚ïê
        let shipMap = {};

        function loadShipMap() {
            ipcRenderer.invoke('settings:get-ship-map').then(map => {
                shipMap = map || {};
                renderShipMapList();
            });
        }

        function renderShipMapList() {
            const list = document.getElementById('ship-map-list');
            if (Object.keys(shipMap).length === 0) {
                list.innerHTML = '<div style="padding: 10px; font-style: italic; color: #555; text-align: center;">No mappings set.</div>';
                return;
            }
            list.innerHTML = Object.entries(shipMap).map(([name, path]) => `
                <div class="map-item" style="display: flex; justify-content: space-between; align-items: center; padding: 6px 10px; border-bottom: 1px solid rgba(255,255,255,0.05);">
                    <div style="flex: 1;">
                        <span style="color: var(--accent); font-weight: bold;">${name}</span>
                        <div style="font-size: 0.7rem; color: #888; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; max-width: 200px;">${path}</div>
                    </div>
                    <button class="cyber-btn small danger" onclick="removeShipMapping('${name}')" style="margin:0; padding: 2px 8px;">√ó</button>
                </div>
            `).join('');
        }

        function selectNewShipImage() {
            ipcRenderer.invoke('app:select-ship-image').then(path => {
                if (path) {
                    document.getElementById('new-ship-image-path').value = path;
                    document.getElementById('new-ship-filename').textContent = path.split(/[\\\\/]/).pop();
                    document.getElementById('new-ship-preview-label').style.display = 'block';
                }
            });
        }

        function addShipMapping() {
            const name = document.getElementById('new-ship-name').value.trim();
            const path = document.getElementById('new-ship-image-path').value;

            if (!name) return alert('Please enter a ship name.');
            if (!path) return alert('Please select an image.');

            shipMap[name] = path;
            saveShipMap();

            // Clear inputs
            document.getElementById('new-ship-name').value = '';
            document.getElementById('new-ship-image-path').value = '';
            document.getElementById('new-ship-preview-label').style.display = 'none';
            renderShipMapList();
        }

        function removeShipMapping(name) {
            delete shipMap[name];
            saveShipMap();
            renderShipMapList();
        }

        function saveShipMap() {
            ipcRenderer.invoke('settings:save-ship-map', shipMap);
        }

        // Initialize (called after ipcRenderer ready? No, call directly here, assuming early enough)
        loadShipMap();


        // ‚ïê‚ïê‚ïê MANUAL PATTERNS (v2.2) ‚ïê‚ïê‚ïê
        let customPatterns = [];

        function loadCustomPatterns() {
            ipcRenderer.invoke('settings:get-custom-patterns').then(patterns => {
                customPatterns = patterns || [];
                renderPatternList();
            });
        }

        function renderPatternList() {
            const list = document.getElementById('pattern-list');
            if (customPatterns.length === 0) {
                list.innerHTML = '<div style="padding: 10px; font-style: italic; color: #555; text-align: center;">No custom patterns defined.</div>';
                return;
            }
            list.innerHTML = customPatterns.map((p, i) => `
                <div class="map-item" style="display: flex; justify-content: space-between; align-items: center; padding: 6px 10px; border-bottom: 1px solid rgba(255,255,255,0.05);">
                    <div style="flex: 1; overflow: hidden;">
                        <div style="font-family: monospace; color: var(--accent); font-size: 0.8rem;">${escapeHtml(p.regex)}</div>
                        <div style="font-size: 0.7rem; color: #888;">
                            <span style="font-weight:bold; color: ${getColorForLevel(p.level)}">${p.level}</span> ${escapeHtml(p.message)}
                        </div>
                    </div>
                    <button class="cyber-btn small danger" onclick="removeCustomPattern(${i})" style="margin:0; padding: 2px 8px;">√ó</button>
                </div>
            `).join('');
        }

        function getColorForLevel(level) {
            switch (level) {
                case 'INFO': return '#4FC3F7';
                case 'WARN': return '#FFA726';
                case 'CRITICAL': return '#FF5252';
                default: return '#eee';
            }
        }

        function addCustomPattern() {
            const regex = document.getElementById('new-pattern-regex').value.trim();
            const level = document.getElementById('new-pattern-level').value;
            const message = document.getElementById('new-pattern-msg').value.trim();

            if (!regex) return alert('Please enter a Regex pattern.');
            if (!message) return alert('Please enter an alert message.');

            // Validate Regex
            try {
                // If input manually wrapped in slashes, use as is. If not, assume body.
                // But JS `new RegExp` takes string.
                // We'll trust user input but validate.
                new RegExp(regex);
            } catch (e) {
                return alert('Invalid Regex: ' + e.message);
            }

            customPatterns.push({ regex, level, message, id: Date.now() });
            saveCustomPatterns();

            document.getElementById('new-pattern-regex').value = '';
            document.getElementById('new-pattern-msg').value = '';
            renderPatternList();
        }

        function removeCustomPattern(index) {
            customPatterns.splice(index, 1);
            saveCustomPatterns();
            renderPatternList();
        }

        function saveCustomPatterns() {
            ipcRenderer.invoke('settings:save-custom-patterns', customPatterns);
        }

        loadCustomPatterns();


        // ‚ïê‚ïê‚ïê UNKNOWN LOG DISCOVERY (Fixed: event delegation, full sample display) ‚ïê‚ïê‚ïê
        // Store groups data for event delegation
        let unknownGroupsData = [];

        function escapeHtml(str) {
            return str.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/"/g, '&quot;');
        }

        function renderUnknowns(groups) {
            unknownGroupsData = groups;
            const list = document.getElementById('unknown-list');
            unknownCount = groups.length;
            document.getElementById('unknown-count-label').textContent = `(${unknownCount})`;

            // Update badge
            const badge = document.getElementById('unknown-badge');
            if (unknownCount > 0) {
                badge.style.display = 'inline';
                badge.textContent = unknownCount;
            } else {
                badge.style.display = 'none';
            }

            if (groups.length === 0) {
                list.innerHTML = '<div style="color: #555; font-style: italic; padding: 15px; text-align: center;">No unknown patterns detected yet.</div>';
                return;
            }

            list.innerHTML = groups.slice(0, 50).map((g, i) => `
                <div class="unknown-item">
                    <div class="unknown-header">
                        <span class="unknown-key">${escapeHtml(g.group)}</span>
                        <span class="unknown-count">${g.count}x</span>
                        <div class="unknown-actions">
                            <button class="btn-copy" data-idx="${i}" title="Copy full log line">üìã</button>
                            <button class="btn-ignore" data-idx="${i}" title="Ignore this pattern">üö´</button>
                        </div>
                    </div>
                    <div class="unknown-sample" title="${escapeHtml(g.sample)}">${escapeHtml(g.sample)}</div>
                </div>
            `).join('');
        }

        // Event delegation for unknown log buttons (fixes broken inline onclick)
        document.getElementById('unknown-list').addEventListener('click', (e) => {
            const btn = e.target.closest('button');
            if (!btn) return;
            const idx = parseInt(btn.dataset.idx);
            if (isNaN(idx) || !unknownGroupsData[idx]) return;

            if (btn.classList.contains('btn-copy')) {
                navigator.clipboard.writeText(unknownGroupsData[idx].sample)
                    .then(() => addDashItem('üìã', 'Copied to clipboard'))
                    .catch(() => addDashItem('‚ùå', 'Copy failed'));
            } else if (btn.classList.contains('btn-ignore')) {
                ipcRenderer.send('log:ignore-unknown', unknownGroupsData[idx].group);
                addDashItem('üö´', `Ignored: ${unknownGroupsData[idx].group.substring(0, 40)}`);
            }
        });

        function refreshUnknowns() {
            ipcRenderer.send('log:request-unknowns');
        }

        function clearUnknowns() {
            ipcRenderer.send('log:clear-unknowns');
        }

        // ‚ïê‚ïê‚ïê ALERT COOLDOWNS ‚ïê‚ïê‚ïê
        function updateCooldown(alertType, seconds) {
            document.getElementById(`cd-${alertType}-val`).textContent = `${seconds}s`;
            ipcRenderer.send('alert:set-cooldown', { alertType, cooldownMs: seconds * 1000 });
        }

        // Initialize cooldowns from defaults
        updateCooldown('suffocating', 5);
        updateCooldown('depressurizing', 5);

        // ‚ïê‚ïê‚ïê SHIP IMAGE ‚ïê‚ïê‚ïê
        function selectShipImage() {
            ipcRenderer.invoke('app:select-ship-image').then(path => {
                if (path) {
                    document.getElementById('ship-image-path').value = path;
                    document.getElementById('ship-preview').style.display = 'block';
                    document.getElementById('ship-preview-img').src = path;
                    // Broadcast to overlay
                    ipcRenderer.send('app:login', ''); // slight hack, we directly use broadcast
                    // Actually, send via main ‚Üí overlay
                    localStorage.setItem('shipImagePath', path);
                    addDashItem('üñºÔ∏è', `Ship image set: ${path.split(/[\\/]/).pop()}`);
                }
            });
        }

        function clearShipImage() {
            document.getElementById('ship-image-path').value = '';
            document.getElementById('ship-preview').style.display = 'none';
            localStorage.removeItem('shipImagePath');
            addDashItem('üñºÔ∏è', 'Ship image cleared');
        }

        // ‚ïê‚ïê‚ïê EVENT LISTENERS ‚ïê‚ïê‚ïê

        // Game log events
        ipcRenderer.on('log:status', (e, data) => {
            const dot = document.getElementById('status-log-dot');
            const txt = document.getElementById('status-log-text');
            if (data.connected) {
                dot.className = 'dot on'; txt.innerText = 'Active';
                document.getElementById('config-log-path').value = data.path || 'Auto-detected';
                if (data.path) addDashItem('üìÇ', `Game.log: <span class="feed-highlight">${data.path}</span>`);
            } else {
                dot.className = 'dot off'; txt.innerText = 'Searching';
            }
        });

        ipcRenderer.on('log:update', (e, data) => {
            switch (data.type) {
                case 'LOCATION':
                    addDashItem('üìç', `Location: <span class="feed-highlight">${data.value}</span>`);
                    break;
                case 'LOCATION_HINT':
                    addDashItem('üó∫Ô∏è', `Area: <span class="feed-highlight">${data.value}</span>`);
                    break;
                case 'QUANTUM':
                    addDashItem('üöÄ', `Quantum: <span class="feed-highlight">${data.value === 'entered' ? 'ENGAGED' : 'DISENGAGED'}</span>`);
                    playSound('alert_zone');
                    break;
                case 'ZONE':
                    if (data.value === 'armistice_enter') { addDashItem('üõ°Ô∏è', 'Entered <span class="feed-highlight">Armistice Zone</span>'); }
                    else if (data.value === 'armistice_leave') { addDashItem('‚ö†Ô∏è', '<span class="feed-highlight" style="color:#ffaa00">LEFT ARMISTICE</span> ‚Äî Weapons Hot'); playSound('alert_zone'); }
                    else if (data.value === 'monitored_enter') { addDashItem('üì°', 'Entered <span class="feed-highlight">Monitored Space</span>'); }
                    break;
                case 'STATUS':
                    if (data.value === 'suffocating') { addDashItem('üòµ', '<span class="feed-highlight" style="color:#ff4444">SUFFOCATING</span>'); playSound('alert_status'); }
                    else if (data.value === 'depressurizing') { addDashItem('üí®', '<span class="feed-highlight" style="color:#ff4444">DEPRESSURIZATION</span>'); playSound('alert_status'); }
                    else if (data.value === 'death') { addDashItem('üíÄ', '<span class="feed-highlight" style="color:#ff4444">DEATH DETECTED</span>'); playSound('alert_death'); }
                    break;
                case 'LOGIN':
                    addDashItem('üëã', `Session: <span class="feed-highlight">${data.handle || 'Login Detected'}</span>`);
                    break;
                case 'PLAYER_NAME':
                    addDashItem('üéÆ', `Pilot: <span class="feed-highlight">${data.value}</span>`);
                    break;
                case 'CHARACTER_NAME':
                    addDashItem('üë§', `Character: <span class="feed-highlight">${data.value}</span>`);
                    break;
                case 'CONNECTION':
                    addDashItem('üîó', `Connection: <span class="feed-highlight">${data.value}</span>`);
                    break;
                case 'LOADING':
                    addDashItem('‚è≥', 'Loading screen...');
                    break;
                // ‚ïê‚ïê‚ïê NEW: Server & Environment ‚ïê‚ïê‚ïê
                case 'SERVER_ENV':
                    addDashItem('üåç', `Server: <span class="feed-highlight">${data.value}</span>`);
                    break;
                case 'SERVER_REGION':
                    addDashItem('üåê', `Region: <span class="feed-highlight">${data.value}</span>`);
                    break;
                case 'SESSION_ID':
                    addDashItem('üîë', `Session: <span class="feed-highlight" style="font-size:0.7rem">${data.value.substring(0, 12)}...</span>`);
                    break;
                // ‚ïê‚ïê‚ïê NEW: Ship Events ‚ïê‚ïê‚ïê
                case 'SHIP_ENTER':
                    addDashItem('üöÄ', `Boarded: <span class="feed-highlight" style="color:#00c8ff">${data.value}</span>`);
                    playSound('notification');
                    break;
                case 'SHIP_EXIT':
                    addDashItem('üö∂', `Exited ship: <span class="feed-highlight">${data.value}</span>`);
                    break;
                case 'SHIP_CURRENT':
                    addDashItem('üöÄ', `Current ship: <span class="feed-highlight" style="color:#00c8ff">${data.value}</span>`);
                    break;
                case 'VEHICLE_SPAWN':
                    addDashItem('üõ∏', `Vehicle spawned: <span class="feed-highlight">${data.value}</span>`);
                    break;
                // ‚ïê‚ïê‚ïê NEW: Game Join/Leave ‚ïê‚ïê‚ïê
                case 'GAME_JOIN':
                    addDashItem('üéÆ', '<span class="feed-highlight" style="color:#00ff88">CONNECTED TO SERVER</span>');
                    playSound('notification');
                    break;
                case 'GAME_LEAVE':
                    addDashItem('üö™', '<span class="feed-highlight" style="color:#ffaa00">DISCONNECTED</span>');
                    playSound('alert_status');
                    break;
                case 'GAME_RESTART':
                    addDashItem('üîÑ', '<span class="feed-highlight">Game restarting...</span>');
                    break;
                // ‚ïê‚ïê‚ïê NEW: Missions ‚ïê‚ïê‚ïê
                case 'MISSION':
                    const mIcons = { accepted: 'üìã', completed: '‚úÖ', failed: '‚ùå' };
                    const mColors = { accepted: '#00c8ff', completed: '#00ff88', failed: '#ff4444' };
                    addDashItem(mIcons[data.value] || 'üìã', `Mission <span class="feed-highlight" style="color:${mColors[data.value] || '#ffa500'}">${data.value.toUpperCase()}</span>`);
                    playSound('notification');
                    break;
                // ‚ïê‚ïê‚ïê NEW: Insurance ‚ïê‚ïê‚ïê
                case 'INSURANCE_CLAIM':
                    addDashItem('üõ°Ô∏è', `<span class="feed-highlight" style="color:#a855f7">INSURANCE CLAIM</span>`);
                    playSound('alert_status');
                    break;
                // ‚ïê‚ïê‚ïê NEW: Docking ‚ïê‚ïê‚ïê
                case 'DOCKING':
                    addDashItem('üîó', `Docking <span class="feed-highlight">${data.value}</span>`);
                    playSound('notification');
                    break;
                // ‚ïê‚ïê‚ïê NEW: Inventory ‚ïê‚ïê‚ïê
                case 'INVENTORY':
                    addDashItem('üì¶', `Inventory <span class="feed-highlight">${data.value}</span>`);
                    break;
                // ‚ïê‚ïê‚ïê NEW: Medical & Spawn ‚ïê‚ïê‚ïê
                case 'MEDICAL_BED':
                    addDashItem('üè•', '<span class="feed-highlight" style="color:#00c8ff">Medical Bed</span>');
                    break;
                case 'SPAWN_SET':
                case 'SPAWN_POINT':
                    addDashItem('üìç', `Spawn: <span class="feed-highlight">${data.value}</span>`);
                    break;
                // ‚ïê‚ïê‚ïê NEW: Party ‚ïê‚ïê‚ïê
                case 'PARTY_INVITE':
                    addDashItem('üì©', '<span class="feed-highlight" style="color:#ffa500">Party invite pending</span>');
                    playSound('notification');
                    break;
                case 'ACCOUNT_LOGIN':
                    addDashItem('‚úÖ', '<span class="feed-highlight" style="color:#00ff88">Account Login Success</span>');
                    break;
                // System info
                case 'SYSTEM_GPU':
                    addDashItem('üñ•Ô∏è', `GPU: <span class="feed-highlight">${data.value}</span>`);
                    break;
                case 'SYSTEM_VRAM':
                    addDashItem('üñ•Ô∏è', `VRAM: <span class="feed-highlight">${data.value}</span>`);
                    break;
                case 'SYSTEM_CPU':
                    addDashItem('üñ•Ô∏è', `CPU: <span class="feed-highlight">${data.value}</span>`);
                    break;
                case 'SYSTEM_RAM':
                    addDashItem('üñ•Ô∏è', `RAM: <span class="feed-highlight">${data.value}</span>`);
                    break;
                case 'GAME_VERSION':
                    addDashItem('üì¶', `SC Branch: <span class="feed-highlight">${data.value}</span>`);
                    break;
                case 'RESOLUTION':
                    addDashItem('üñ•Ô∏è', `Display: <span class="feed-highlight">${data.value}</span>`);
                    break;
                case 'JOYSTICK':
                    addDashItem('üïπÔ∏è', `Controller: <span class="feed-highlight">${data.value}</span>`);
                    break;
                case 'EQUIPMENT':
                    addDashItem('üéí', `Loadout: <span class="feed-highlight">${data.value.item}</span> ‚Üí ${data.value.port}`);
                    break;
            }
        });

        ipcRenderer.on('log:error', (e, data) => {
            addDashItem('‚ùå', `<span style="color:#ff4444">${data.message}</span>`);
            document.getElementById('status-log-dot').className = 'dot off';
            document.getElementById('status-log-text').innerText = 'Error';
        });

        // Unknown log events
        ipcRenderer.on('log:unknown', (e, data) => {
            renderUnknowns(data.groups || []);
        });

        // API connection
        ipcRenderer.on('api:status', (e, status) => {
            const dot = document.getElementById('status-api-dot');
            const txt = document.getElementById('status-api-text');
            if (status.connected) {
                dot.className = 'dot on'; txt.innerText = 'Secure';
                addDashItem('‚úÖ', 'VerseCon API Connected');
            } else {
                dot.className = 'dot off'; txt.innerText = 'Disconnected';
            }
        });

        // Party data
        ipcRenderer.on('api:party', (e, data) => {
            addDashItem('üë•', `Party: <span class="feed-highlight">${data.members ? data.members.length : 0} Members</span>`);
        });

        // VerseCon platform events
        ipcRenderer.on('vcon:beacon', (e, data) => {
            addVconItem('üÜò', `<span class="feed-highlight" style="color:#FF2E63">BEACON</span> ‚Äî ${data.message || 'Distress signal!'}`);
            playSound('beacon');
        });

        ipcRenderer.on('vcon:job', (e, data) => {
            addVconItem('üìú', `<span class="feed-highlight">CONTRACT</span> ‚Äî ${data.message || 'New contract posted'}`);
            playSound('contract');
        });

        ipcRenderer.on('vcon:party_event', (e, data) => {
            const icon = data.type === 'LFG' ? 'üéÆ' : 'üéØ';
            const label = data.type === 'LFG' ? 'LFG' : 'OPERATION';
            addVconItem(icon, `<span class="feed-highlight">${label}</span> ‚Äî ${data.message || 'New event'}`);
            playSound('notification');
        });

        ipcRenderer.on('vcon:trade', (e, data) => {
            addVconItem('üí∞', `<span class="feed-highlight" style="color:#22C55E">TRADE MATCH</span> ‚Äî ${data.message || 'Price alert'}`);
            playSound('notification');
        });

        // Command events
        ipcRenderer.on('command:receive', (e, data) => {
            addCommandLog(data.preset || data.text, data.target || 'YOU', data.from || 'COMMAND');
            playSound(data.preset === 'EMERGENCY' ? 'sos' : 'command');
            // Also show in dashboard feed
            addDashItem('üì¢', `<span class="feed-highlight" style="color:#ffa500">ORDER: ${data.preset || data.text}</span> from ${data.from || 'Command'}`);
        });

        ipcRenderer.on('command:sent', (e, data) => {
            // Visual confirmation
        });

        // Auth deep link
        ipcRenderer.on('auth:success', (e, token) => {
            document.getElementById('auth-ui-guest').style.display = 'none';
            document.getElementById('auth-ui-user').style.display = 'block';
            addDashItem('‚úÖ', 'Authenticated via Browser!');
        });

        // DND toggle
        ipcRenderer.on('app:dnd', (e, data) => {
            addDashItem('üîï', data.enabled ? 'Do Not Disturb: ON' : 'Do Not Disturb: OFF');
        });

        // Keyboard shortcut for sending commands
        document.getElementById('cmd-custom-text').addEventListener('keydown', (e) => {
            if (e.key === 'Enter') sendCustomCommand();
        });

        // ‚ïê‚ïê‚ïê BUILT-IN PATTERN MANAGER (v2.2) ‚ïê‚ïê‚ïê
        let defaultPatterns = {};
        let patternOverrides = {};

        async function loadBuiltinPatterns() {
            try {
                defaultPatterns = await ipcRenderer.invoke('settings:get-default-patterns');
                patternOverrides = await ipcRenderer.invoke('settings:get-pattern-overrides');
                renderBuiltinPatterns();
            } catch (e) {
                console.error('Failed to load patterns:', e);
            }
        }

        function renderBuiltinPatterns() {
            const list = document.getElementById('builtin-pattern-list');
            if (!list) return;
            list.innerHTML = '';

            const keys = Object.keys(defaultPatterns).sort();

            keys.forEach(key => {
                const config = patternOverrides[key] || {};
                const isOverridden = config.regex && config.regex !== defaultPatterns[key];
                const isDisabled = config.disabled;
                const currentValue = config.regex || defaultPatterns[key];

                const div = document.createElement('div');
                div.style.cssText = 'padding: 8px; border-bottom: 1px solid rgba(255,255,255,0.05); display: flex; flex-direction: column; gap: 5px;';

                const header = document.createElement('div');
                header.style.cssText = 'display: flex; justify-content: space-between; align-items: center;';

                const label = document.createElement('label');
                label.style.cssText = 'font-family: monospace; color: var(--accent); font-size: 0.8rem; display: flex; align-items: center; gap: 5px; cursor: pointer;';

                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.checked = !isDisabled;
                checkbox.onchange = (e) => togglePattern(key, e.target.checked);

                label.appendChild(checkbox);
                label.appendChild(document.createTextNode(key));

                const status = document.createElement('span');
                status.style.fontSize = '0.7rem';
                if (isDisabled) {
                    status.textContent = 'DISABLED';
                    status.style.color = '#ff4444';
                } else if (isOverridden) {
                    status.textContent = 'MODIFIED';
                    status.style.color = 'var(--accent)';
                } else {
                    status.textContent = 'DEFAULT';
                    status.style.color = '#666';
                }

                header.appendChild(label);
                header.appendChild(status);

                const input = document.createElement('input');
                input.type = 'text';
                input.className = 'modern-input';
                input.style.cssText = 'font-family: monospace; font-size: 0.75rem; margin: 0; width: 100%; color: ' + (isOverridden ? 'var(--text)' : '#888');
                input.value = currentValue;
                input.onchange = (e) => updatePatternRegex(key, e.target.value);
                if (isDisabled) {
                    input.disabled = true;
                    input.style.opacity = '0.5';
                }

                div.appendChild(header);
                div.appendChild(input);
                list.appendChild(div);
            });
        }

        function togglePattern(key, enabled) {
            if (!patternOverrides[key]) patternOverrides[key] = {};
            patternOverrides[key].disabled = !enabled;
            renderBuiltinPatterns();
        }

        function updatePatternRegex(key, regex) {
            if (!patternOverrides[key]) patternOverrides[key] = {};
            patternOverrides[key].regex = regex;
            renderBuiltinPatterns();
        }

        async function savePatternOverrides() {
            await ipcRenderer.invoke('settings:save-pattern-overrides', patternOverrides);
            const btn = document.activeElement;
            if (btn && btn.tagName === 'BUTTON') {
                const originalText = btn.innerText;
                btn.innerText = 'Saved!';
                setTimeout(() => btn.innerText = originalText, 2000);
            }
        }

        async function resetPatternOverrides() {
            if (confirm('Reset all built-in patterns to default?')) {
                patternOverrides = {};
                await ipcRenderer.invoke('settings:save-pattern-overrides', patternOverrides);
                renderBuiltinPatterns();
            }
        }

        // Init
        loadBuiltinPatterns();
    </script>
</body>

</html>