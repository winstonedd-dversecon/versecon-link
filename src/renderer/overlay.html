<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>VerseCon Overlay</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Rajdhani:wght@400;600;700&display=swap');

        :root {
            --bg-glass: rgba(11, 12, 16, 0.6);
            --accent: #ffa500;
            --cyan: #00c8ff;
            --text-main: #e0e0e0;
            --text-dim: #8892b0;
            --success: #00ff88;
            --danger: #ff4444;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: transparent;
            font-family: 'Rajdhani', sans-serif;
            color: var(--text-main);
            overflow-y: auto;
            overflow-x: hidden;
        }

        .hud-module {
            background: var(--bg-glass);
            backdrop-filter: blur(8px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-left: 3px solid var(--accent);
            padding: 10px 14px;
            margin-bottom: 8px;
            transform: skewX(-2deg);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.4);
            transition: all 0.3s ease;
        }

        .hud-label {
            font-size: 0.6rem;
            text-transform: uppercase;
            letter-spacing: 3px;
            color: var(--text-dim);
            margin-bottom: 3px;
        }

        .hud-value {
            font-size: 1.05rem;
            font-weight: 700;
            color: white;
        }

        /* Module accent colors */
        .mod-location {
            border-left-color: var(--cyan);
        }

        .mod-location .hud-value {
            color: var(--cyan);
        }

        .mod-quantum {
            border-left-color: var(--accent);
        }

        .mod-quantum .hud-value {
            color: var(--accent);
        }

        .mod-zone {
            border-left-color: var(--success);
        }

        .mod-zone .hud-value {
            color: var(--success);
        }

        .mod-party {
            border-left-color: #a855f7;
        }

        .mod-party .hud-value {
            color: #a855f7;
        }

        .mod-command {
            border-left-color: var(--accent);
            background: rgba(255, 165, 0, 0.1);
            animation: commandGlow 1s ease-in-out 3;
        }

        .mod-command .hud-value {
            color: var(--accent);
            font-size: 1.1rem;
        }

        .mod-status {
            border-left-color: var(--danger);
            background: rgba(255, 0, 0, 0.1);
        }

        .mod-status .hud-value {
            color: var(--danger);
        }

        .mod-connection {
            border-left-color: #888;
        }

        /* Quantum glow effect */
        .quantum-engaged {
            border-left-color: var(--accent);
            box-shadow: 0 0 15px rgba(255, 165, 0, 0.3);
        }

        .quantum-engaged .hud-value {
            text-shadow: 0 0 10px rgba(255, 165, 0, 0.6);
        }

        /* Zone transitions */
        .zone-armistice .hud-value {
            color: var(--success);
        }

        .zone-caution .hud-value {
            color: #ffaa00;
        }

        .zone-monitored .hud-value {
            color: var(--cyan);
        }

        .zone-kia .hud-value {
            color: var(--danger);
        }

        /* Party members */
        .party-member {
            font-size: 0.8rem;
            padding: 2px 0;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .party-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: var(--success);
        }

        /* ACK button (not click-through) */
        .ack-btn {
            background: linear-gradient(45deg, var(--accent), #ff8800);
            color: #000;
            border: none;
            padding: 6px 12px;
            font-weight: 700;
            font-family: inherit;
            text-transform: uppercase;
            cursor: pointer;
            margin-top: 5px;
            font-size: 0.75rem;
            letter-spacing: 1px;
        }

        .ack-btn:hover {
            filter: brightness(1.2);
        }

        /* Command log in overlay */
        .cmd-feed {
            max-height: 100px;
            overflow-y: auto;
            margin-top: 5px;
        }

        .cmd-feed-item {
            font-size: 0.75rem;
            padding: 3px 0;
            color: var(--text-dim);
            border-bottom: 1px solid rgba(255, 255, 255, 0.03);
        }

        .cmd-feed-item .cmd-order {
            color: var(--accent);
            font-weight: 600;
        }

        @keyframes commandGlow {

            0%,
            100% {
                box-shadow: 0 2px 10px rgba(0, 0, 0, 0.4);
            }

            50% {
                box-shadow: 0 0 20px rgba(255, 165, 0, 0.4);
            }
        }

        ::-webkit-scrollbar {
            width: 3px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 2px;
        }
    </style>
</head>

<body>
    <!-- Location -->
    <div class="hud-module mod-location" id="mod-location">
        <div class="hud-label">Current Location</div>
        <div class="hud-value" id="hud-location">LOADING...</div>
    </div>

    <!-- Quantum Drive -->
    <div class="hud-module mod-quantum" id="mod-quantum">
        <div class="hud-label">Quantum Drive</div>
        <div class="hud-value" id="hud-quantum">IDLE</div>
    </div>

    <!-- Zone Status -->
    <div class="hud-module mod-zone" id="mod-zone">
        <div class="hud-label">Zone Status</div>
        <div class="hud-value" id="hud-zone">â€”</div>
    </div>

    <!-- Player Status -->
    <div class="hud-module mod-status" id="mod-status" style="display:none;">
        <div class="hud-label">Alert</div>
        <div class="hud-value" id="hud-status">â€”</div>
    </div>

    <!-- Connection -->
    <div class="hud-module mod-connection" id="mod-connection">
        <div class="hud-label">Connection</div>
        <div class="hud-value" id="hud-connection">SEARCHING...</div>
    </div>

    <!-- Party / Squadron -->
    <div class="hud-module mod-party" id="mod-party">
        <div class="hud-label">Squadron <span id="party-count" style="color:#aaa;">(0)</span></div>
        <div id="party-list">
            <div class="hud-value" style="font-size:0.8rem; color: var(--text-dim);">No Signal</div>
        </div>
    </div>

    <!-- Active Command -->
    <div class="hud-module mod-command" id="mod-command" style="display:none;">
        <div class="hud-label">Active Order</div>
        <div class="hud-value" id="hud-command-text">â€”</div>
        <div style="font-size: 0.7rem; color: var(--text-dim);" id="hud-command-from">â€”</div>
        <button class="ack-btn" id="ack-btn" onclick="ackCommand()">âœ“ ACK</button>
        <div class="cmd-feed" id="cmd-feed"></div>
    </div>

    <script>
        const { ipcRenderer } = require('electron');

        let lastCommandId = null;

        // â•â•â• GAME LOG UPDATES â•â•â•
        ipcRenderer.on('log:update', (e, data) => {
            switch (data.type) {
                case 'LOCATION':
                case 'LOCATION_HINT':
                    document.getElementById('hud-location').textContent = data.value;
                    break;

                case 'QUANTUM':
                    const qMod = document.getElementById('mod-quantum');
                    const qVal = document.getElementById('hud-quantum');
                    if (data.value === 'entered') {
                        qVal.textContent = 'ENGAGED';
                        qMod.classList.add('quantum-engaged');
                    } else {
                        qVal.textContent = 'IDLE';
                        qMod.classList.remove('quantum-engaged');
                    }
                    break;

                case 'ZONE':
                    const zMod = document.getElementById('mod-zone');
                    const zVal = document.getElementById('hud-zone');
                    zMod.className = 'hud-module mod-zone';
                    if (data.value === 'armistice_enter') {
                        zVal.textContent = 'ðŸ›¡ï¸ ARMISTICE â€” SAFE';
                        zMod.classList.add('zone-armistice');
                    } else if (data.value === 'armistice_leave') {
                        zVal.textContent = 'âš ï¸ CAUTION â€” WEAPONS HOT';
                        zMod.classList.add('zone-caution');
                    } else if (data.value === 'monitored_enter') {
                        zVal.textContent = 'ðŸ“¡ MONITORED SPACE';
                        zMod.classList.add('zone-monitored');
                    }
                    break;

                case 'STATUS':
                    const sMod = document.getElementById('mod-status');
                    const sVal = document.getElementById('hud-status');
                    sMod.style.display = 'block';
                    if (data.value === 'death') {
                        sVal.textContent = 'ðŸ’€ KILLED IN ACTION';
                        document.getElementById('mod-zone').className = 'hud-module mod-zone zone-kia';
                        document.getElementById('hud-zone').textContent = 'â˜ ï¸ KIA';
                    } else if (data.value === 'suffocating') {
                        sVal.textContent = 'ðŸ˜µ SUFFOCATING';
                    } else if (data.value === 'depressurizing') {
                        sVal.textContent = 'ðŸ’¨ DEPRESSURIZATION';
                    }
                    // Auto-hide after 10s
                    setTimeout(() => { sMod.style.display = 'none'; }, 10000);
                    break;

                case 'CONNECTION':
                    document.getElementById('hud-connection').textContent = data.value;
                    break;

                case 'LOGIN':
                    document.getElementById('hud-connection').textContent = `ONLINE â€” ${data.handle || 'Connected'}`;
                    break;

                case 'EQUIPMENT':
                    // don't clutter overlay with equipment
                    break;
            }
        });

        // â•â•â• PARTY â•â•â•
        ipcRenderer.on('api:party', (e, data) => {
            const list = document.getElementById('party-list');
            const count = document.getElementById('party-count');

            if (data.members && data.members.length > 0) {
                count.textContent = `(${data.members.length})`;
                list.innerHTML = data.members.map(m => `
                    <div class="party-member">
                        <span class="party-dot" style="background: ${m.online ? 'var(--success)' : '#555'}"></span>
                        ${m.name || m.handle || 'Unknown'}
                    </div>
                `).join('');
            } else {
                count.textContent = '(0)';
                list.innerHTML = '<div class="hud-value" style="font-size:0.8rem; color: var(--text-dim);">No Signal</div>';
            }
        });

        // â•â•â• CONNECTION STATUS â•â•â•
        ipcRenderer.on('log:status', (e, data) => {
            if (data.connected) {
                document.getElementById('hud-connection').textContent = 'GAME LOG ACTIVE';
                document.getElementById('mod-connection').style.borderLeftColor = 'var(--success)';
            } else {
                document.getElementById('hud-connection').textContent = 'SEARCHING...';
                document.getElementById('mod-connection').style.borderLeftColor = '#888';
            }
        });

        ipcRenderer.on('api:status', (e, status) => {
            const conn = document.getElementById('hud-connection');
            if (status.connected) {
                conn.textContent = conn.textContent.includes('LOG') ? conn.textContent + ' | API âœ“' : 'API CONNECTED';
            }
        });

        // â•â•â• COMMAND MODULE â•â•â•
        ipcRenderer.on('command:receive', (e, data) => {
            const cmdMod = document.getElementById('mod-command');
            const cmdText = document.getElementById('hud-command-text');
            const cmdFrom = document.getElementById('hud-command-from');
            const ackBtn = document.getElementById('ack-btn');

            cmdMod.style.display = 'block';
            cmdText.textContent = data.preset || data.text || 'ATTENTION';
            cmdFrom.textContent = `FROM: ${(data.from || 'COMMAND').toUpperCase()} â†’ ${(data.target || 'ALL').toUpperCase()}`;
            lastCommandId = data.id || Date.now();
            ackBtn.style.display = 'inline-block';

            // Reset glow animation
            cmdMod.style.animation = 'none';
            cmdMod.offsetHeight;
            cmdMod.style.animation = 'commandGlow 1s ease-in-out 3';

            // Add to command feed
            addCmdFeed(data);
        });

        function addCmdFeed(data) {
            const feed = document.getElementById('cmd-feed');
            const time = new Date().toLocaleTimeString([], { hour12: false });
            const item = document.createElement('div');
            item.className = 'cmd-feed-item';
            item.innerHTML = `<span style="color:#888">${time}</span> <span class="cmd-order">${data.preset || data.text}</span>`;
            feed.prepend(item);
            if (feed.children.length > 10) feed.lastElementChild.remove();
        }

        function ackCommand() {
            if (lastCommandId) {
                ipcRenderer.send('command:ack', { commandId: lastCommandId });
                document.getElementById('ack-btn').style.display = 'none';
                document.getElementById('hud-command-from').textContent += ' â€” âœ“ ACKNOWLEDGED';
            }
        }

        // â•â•â• DND MODE â•â•â•
        ipcRenderer.on('app:dnd', (e, data) => {
            // Could dim overlay or show DND indicator
        });
    </script>
</body>

</html>